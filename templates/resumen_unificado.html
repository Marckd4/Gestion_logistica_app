{% extends 'base.html' %}

{% block content %}

<br>

<!-- BOTÃ“N DE ACTUALIZAR -->
<a href="{% url 'resumen_unificado' %}" class="btn btn-primary mb-3">
    ðŸ”„ Actualizar
</a>

<input id="searchInput" type="text" class="form-control mb-3" placeholder="Buscar...">

<style>
.fila-diferente {
    background-color: #ffcccc !important; /* Rojo suave */
}
</style>

<div class="table-scroll">
<table id="dataTable" class="table table-striped table-hover table-bordered">
    <thead>
        <tr>
            <th>Cod DUN</th>
            <th>Cod EAN</th>
            <th>Cod Sistema BSF</th>
            <th>Cod Sistema Central</th>
            <th>DescripciÃ³n</th>
            <th>Total cajas BSF</th>
            <th>Total cajas Lingues</th>
            <th>Saldo BSF</th>
            <th>Saldo Lingues</th>
            <th>Total Cajas</th>
        </tr>
    </thead>

    <tbody>
        {% for item in resumen %}

        <!-- FILA EN ROJO SI LOS CODIGOS DE SISTEMA NO COINCIDEN -->
        <tr class="{% if item.cod_sistema_bsf|default:'' != item.cod_sistema_central|default:'' %}fila-diferente{% endif %}">
            <td>{{ item.cod_dun }}</td>
            <td>{{ item.cod_ean }}</td>
            <td>{{ item.cod_sistema_bsf }}</td>
            <td>{{ item.cod_sistema_central }}</td>
            <td>{{ item.descripcion }}</td>
            <td>{{ item.cajas_bsf }}</td>
            <td>{{ item.cajas_central }}</td>
            <td>{{ item.stock_bsf }}</td>
            <td>{{ item.stock_central }}</td>
            <td>{{ item.total_cajas }}</td>
        </tr>

        {% endfor %}
    </tbody>
</table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const input = document.getElementById("searchInput");
    const table = document.getElementById("dataTable");
    const rows = table.getElementsByTagName("tr");

    input.addEventListener("keyup", function () {

        const filter = input.value.toLowerCase().trim();

        if (filter === "") {
            for (let i = 1; i < rows.length; i++) {
                rows[i].style.display = "";
            }
            return;
        }

        for (let i = 1; i < rows.length; i++) {

            const cells = rows[i].getElementsByTagName("td");
            let match = false;

            for (let j = 0; j < cells.length; j++) {
                const text = (cells[j].textContent || "").toLowerCase();

                if (text.includes(filter)) {
                    match = true;
                    break;
                }
            }

            rows[i].style.display = match ? "" : "none";
        }
    });
});
</script>

{% endblock %}

